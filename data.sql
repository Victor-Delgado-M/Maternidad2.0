CREATE TABLE DOCTOR(
		ID_DOCTOR INT PRIMARY KEY NOT NULL,
		NOMBRE_DOC VARCHAR(20),
		CEDULA_DOC VARCHAR(10),
		ESPECIALIDAD_DOC VARCHAR(20));

	CREATE TABLE PACIENTE(
		ID_PACIENTE INT PRIMARY KEY NOT NULL,
		CEDULA_PACIENTE VARCHAR(10),
		NOMBRE_PACIENTE VARCHAR(15),
		APELLIDO_PACIENTE VARCHAR(15),
		DIRECCION_PACIENTE VARCHAR(25),
		TELEFONO_PACIENTE VARCHAR(10),
		FECHA_DE_REGISTRO_PACIENTE DATE,
		ID_DOCTORPK INT,
		FOREIGN KEY(ID_DOCTORPK)REFERENCES DOCTOR(ID_DOCTOR));

	CREATE TABLE MEDICINA(
		ID_MEDICINA INT PRIMARY KEY NOT NULL,
		DESCRIPCION_MEDICINA VARCHAR(15),
		UNIDAD VARCHAR(10),
		PRESENTACION VARCHAR(15),
		VACUNA VARCHAR(15),
		FECHA_DE_DOSIS DATE,
		DOSIS VARCHAR(15),
		ID_PACIENTEPK INT,
		ID_DOCTORPK INT,
		FOREIGN KEY(ID_PACIENTEPK)REFERENCES PACIENTE(ID_PACIENTE),
		FOREIGN KEY(ID_DOCTORPK)REFERENCES DOCTOR(ID_DOCTOR));

	CREATE TABLE INFANTE(
		ID_INFANTE INT PRIMARY KEY NOT NULL ,
		NOMBRE_INFANTE VARCHAR(10),
		FECHA_DE_INGRESO DATE,
		GENERO VARCHAR(15),
		ID_MEDICINAPK INT,
		FOREIGN KEY(ID_MEDICINAPK)REFERENCES MEDICINA(ID_MEDICINA));

	CREATE TABLE CONSULTA(
		ID_CONSULTA INT PRIMARY KEY NOT NULL,
		NOMBRE_PACIENTES VARCHAR(15),
		CONTROL_FECHAS DATE,
		VISITA_1 VARCHAR(10),
		VISITA_2 VARCHAR(10),
		VISITA_3 VARCHAR(10),
		VISITA_4 VARCHAR(10),
		VISITA_5 VARCHAR(10),
		TOTAL_CONSULTAS VARCHAR(15),
		ID_PACIENTEPK INT,
		ID_INFANTEPK INT,
		FOREIGN KEY(ID_PACIENTEPK)REFERENCES PACIENTE(ID_PACIENTE),
		FOREIGN KEY (ID_INFANTEPK)REFERENCES INFANTE(ID_INFANTE));

	CREATE TABLE VISITAS(
		ID_VISITAS INT PRIMARY KEY NOT NULL,
		NUEVA_VISITA VARCHAR(15),
		TOTAL_VISITAS VARCHAR(15),
		ID_PACIENTEPK INT,
		FOREIGN KEY(ID_PACIENTEPK)REFERENCES PACIENTE(ID_PACIENTE));

	INSERT INTO VISITAS (ID_VISITAS,NUEVA_VISITA,TOTAL_VISITAS,ID_PACIENTEPK)VALUES
	(100,'','5',489)
	INSERT INTO VISITAS (ID_VISITAS,NUEVA_VISITA,TOTAL_VISITAS,ID_PACIENTEPK)VALUES
	(101,'','5',569)
	INSERT INTO VISITAS (ID_VISITAS,NUEVA_VISITA,TOTAL_VISITAS,ID_PACIENTEPK)VALUES
	(102,'','5',751)
	INSERT INTO VISITAS (ID_VISITAS,NUEVA_VISITA,TOTAL_VISITAS,ID_PACIENTEPK)VALUES
	(103,'','5',165)
	INSERT INTO VISITAS (ID_VISITAS,NUEVA_VISITA,TOTAL_VISITAS,ID_PACIENTEPK)VALUES
	(104,'','5',395)
	SELECT * FROM VISITAS

	INSERT INTO DOCTOR (ID_DOCTOR,NOMBRE_DOC,CEDULA_DOC,ESPECIALIDAD_DOC)VALUES
	(01,'ISABEL ALLENDE','1304800259','PEDIATRA')
	INSERT INTO DOCTOR (ID_DOCTOR,NOMBRE_DOC,CEDULA_DOC,ESPECIALIDAD_DOC)VALUES
	(02,'ISMAEL PAEZ','1305956211','GINECOLOGO')
	INSERT INTO DOCTOR (ID_DOCTOR,NOMBRE_DOC,CEDULA_DOC,ESPECIALIDAD_DOC)VALUES
	(03,'ORLANDO CHICO','1309632887','GINECO_OBSTETRA')
	INSERT INTO DOCTOR (ID_DOCTOR,NOMBRE_DOC,CEDULA_DOC,ESPECIALIDAD_DOC)VALUES
	(04,'GAEL GUADAMUND','1304800251','GINECOLOGO')
	INSERT INTO DOCTOR (ID_DOCTOR,NOMBRE_DOC,CEDULA_DOC,ESPECIALIDAD_DOC)VALUES
	(05,'JIMMY FALLON','1308598773','PEDIATRA')
    SELECT * FROM DOCTOR

	INSERT INTO PACIENTE (ID_PACIENTE,CEDULA_PACIENTE,NOMBRE_PACIENTE,APELLIDO_PACIENTE,DIRECCION_PACIENTE,TELEFONO_PACIENTE,FECHA_DE_REGISTRO_PACIENTE,ID_DOCTORPK)VALUES
	(489,'1306945628','SOLANGE','SOLORZANO','LOS ALMENDROS','0985741259','03-03-2020',01)
	INSERT INTO PACIENTE (ID_PACIENTE,CEDULA_PACIENTE,NOMBRE_PACIENTE,APELLIDO_PACIENTE,DIRECCION_PACIENTE,TELEFONO_PACIENTE,FECHA_DE_REGISTRO_PACIENTE,ID_DOCTORPK)VALUES
	(569,'1316689742','MARILYN','LOOR','URB TERRAMAR','095622214','05-01-2020',02)
	INSERT INTO PACIENTE (ID_PACIENTE,CEDULA_PACIENTE,NOMBRE_PACIENTE,APELLIDO_PACIENTE,DIRECCION_PACIENTE,TELEFONO_PACIENTE,FECHA_DE_REGISTRO_PACIENTE,ID_DOCTORPK)VALUES
	(751,'1305520111','BERENICE','CAICEDO','CALLE 8','0856412433','07-02-2020',03)
	INSERT INTO PACIENTE (ID_PACIENTE,CEDULA_PACIENTE,NOMBRE_PACIENTE,APELLIDO_PACIENTE,DIRECCION_PACIENTE,TELEFONO_PACIENTE,FECHA_DE_REGISTRO_PACIENTE,ID_DOCTORPK)VALUES
	(165,'1318927888','MIA','RODRIGUEZ','LOS BAJOS','0956622571','02-06-2020',04)
	INSERT INTO PACIENTE (ID_PACIENTE,CEDULA_PACIENTE,NOMBRE_PACIENTE,APELLIDO_PACIENTE,DIRECCION_PACIENTE,TELEFONO_PACIENTE,FECHA_DE_REGISTRO_PACIENTE,ID_DOCTORPK)VALUES
	(395,'1305522162','LIA','VELEZ','LOS ESTEROS','0936555987','10-12-2020',05)
	SELECT * FROM PACIENTE;

	INSERT INTO MEDICINA (ID_MEDICINA,DESCRIPCION_MEDICINA,UNIDAD,PRESENTACION,VACUNA,FECHA_DE_DOSIS,DOSIS,ID_PACIENTEPK,ID_DOCTORPK)VALUES
	(011,'TÃ‰TANO','MILIGRAMOS','FRASCO','HEPATITIS_B','2020-01-13','1 DOSIS',489,01)
	INSERT INTO MEDICINA (ID_MEDICINA,DESCRIPCION_MEDICINA,UNIDAD,PRESENTACION,VACUNA,FECHA_DE_DOSIS,DOSIS,ID_PACIENTEPK,ID_DOCTORPK)VALUES
	(012,'DIFTERIA','MILIGRAMOS','TABLETAS','HIB','2020-05-12','3 DOSIS',569,02)
	INSERT INTO MEDICINA (ID_MEDICINA,DESCRIPCION_MEDICINA,UNIDAD,PRESENTACION,VACUNA,FECHA_DE_DOSIS,DOSIS,ID_PACIENTEPK,ID_DOCTORPK)VALUES
	(013,'PERTUSSIS','MILIGRAMOS','POLVO','PERTUSSIS','2020-12-22','5 DOSIS',751,03)
	INSERT INTO MEDICINA (ID_MEDICINA,DESCRIPCION_MEDICINA,UNIDAD,PRESENTACION,VACUNA,FECHA_DE_DOSIS,DOSIS,ID_PACIENTEPK,ID_DOCTORPK)VALUES
	(014,'HIB','MILIGRAMOS','TETANO','FRASCO','2020-11-11','4 DOSIS',165,04)
	INSERT INTO MEDICINA (ID_MEDICINA,DESCRIPCION_MEDICINA,UNIDAD,PRESENTACION,VACUNA,FECHA_DE_DOSIS,DOSIS,ID_PACIENTEPK,ID_DOCTORPK)VALUES
	(015,'POLIOMIELITIS','MILIGRAMOS','TABLETAS','DIFTERIA','2020-08-30','2 DOSIS',395,05)
	SELECT * FROM MEDICINA;

	INSERT INTO INFANTE (ID_INFANTE,NOMBRE_INFANTE,FECHA_DE_INGRESO,GENERO,ID_MEDICINAPK)VALUES
	(0155,'SAMUEL','2020-03-11','MASCULINO',012)
	INSERT INTO INFANTE (ID_INFANTE,NOMBRE_INFANTE,FECHA_DE_INGRESO,GENERO,ID_MEDICINAPK)VALUES
	(0520,'ISSAC','2020-01-10','MASCULINO',011)
	INSERT INTO INFANTE (ID_INFANTE,NOMBRE_INFANTE,FECHA_DE_INGRESO,GENERO,ID_MEDICINAPK)VALUES
	(0780,'LIAM','2020-02-14','MASCULINO',013)	
	INSERT INTO INFANTE (ID_INFANTE,NOMBRE_INFANTE,FECHA_DE_INGRESO,GENERO,ID_MEDICINAPK)VALUES
	(0235,'CAMILA','2020-06-15','FEMENINO',014)
	INSERT INTO INFANTE (ID_INFANTE,NOMBRE_INFANTE,FECHA_DE_INGRESO,GENERO,ID_MEDICINAPK)VALUES
	(0895,'SALOME','2020-04-16','FEMENINO',015)
	SELECT * FROM INFANTE;

	INSERT INTO CONSULTA (ID_CONSULTA,NOMBRE_PACIENTES,CONTROL_FECHAS,VISITA_1,VISITA_2,VISITA_3,VISITA_4,VISITA_5,ID_PACIENTEPK,ID_INFANTEPK)VALUES
	(489,'CECILIA','03-03-2020','23-12-2020','03-07-2020','21-08-2020','9-09-2020','05-10-2020',489,0155)
	INSERT INTO CONSULTA (ID_CONSULTA,NOMBRE_PACIENTES,CONTROL_FECHAS,VISITA_1,VISITA_2,VISITA_3,VISITA_4,VISITA_5,ID_PACIENTEPK,ID_INFANTEPK)VALUES
	(569,'LIA','05-01-2020','22-03-2020','05-06-2020','20-09-2020','6-10-2020','03-05-2020',569,0520)
	INSERT INTO CONSULTA (ID_CONSULTA,NOMBRE_PACIENTES,CONTROL_FECHAS,VISITA_1,VISITA_2,VISITA_3,VISITA_4,VISITA_5,ID_PACIENTEPK,ID_INFANTEPK)VALUES
	(715,'MARY','07-02-2020','25-06-2020','08-03-2020','19-02-2020','08-02-2020','09-08-2020',751,0780)
	INSERT INTO CONSULTA (ID_CONSULTA,NOMBRE_PACIENTES,CONTROL_FECHAS,VISITA_1,VISITA_2,VISITA_3,VISITA_4,VISITA_5,ID_PACIENTEPK,ID_INFANTEPK)VALUES
	(416,'MIA','02-06-2020','02-07-2020','07-04-2020','21-04-2020','05-09-2020','20-06-2020',165,0235)
	INSERT INTO CONSULTA (ID_CONSULTA,NOMBRE_PACIENTES,CONTROL_FECHAS,VISITA_1,VISITA_2,VISITA_3,VISITA_4,VISITA_5,ID_PACIENTEPK,ID_INFANTEPK)VALUES
	(867,'ESTHER','2020-02-03','19-09-2020','10-07-2020','21-07-2020','01-05-2020','01-09-2020',395,0895)
	SELECT * FROM CONSULTA;

	-- TABLA ACTUALIZAR TRIGGERS -- 
	CREATE TABLE VISITANUEVA (
	FECHA DATE,
	ID_PACIENTEPK INT,
	DESCRIPCION VARCHAR (20);
	
	SELECT * FROM VISITANUEVA;

	-- ACTUALIZAR VISITA --
	CREATE TRIGGER TR_NUMEROVISITA
	ON VISITAS FOR UPDATE 
	AS
	SET NOCOUNT ON
	DECLARE @ID_PACIENTEPK INT
	SELECT @ID_PACIENTEPK = ID_PACIENTEPK FROM INSERTED
	INSERT INTO VISITANUEVA VALUES(GETDATE(),@ID_PACIENTEPK,
	'VISITA ACTUALIZADA',SYSTEM_USER)
	GO
	UPDATE VISITAS SET NUEVA_VISITA ='2020-11-09',TOTAL_VISITAS='6' WHERE ID_PACIENTEPK = 489
	SELECT * FROM VISITANUEVA
	SELECT * FROM VISITAS
	SELECT * FROM DOCTOR

-- CURSOR DOCTORES Y PACIENTES--
	DECLARE  @ID_DOCTOR CHAR(15),@NOMBRE_DOC CHAR(15),@ESPECIALIDAD_DOC CHAR(15),
			 @NOMBRE_PACIENTES CHAR(15),@APELLIDO CHAR(15),
			 @FECHA_DE_REGISTRO CHAR(15)	 
	DECLARE CUR_DOCTORES CURSOR 
	FOR SELECT DOC.ID_DOCTOR,DOC.NOMBRE_DOC,DOC.ESPECIALIDAD_DOC,PAC.NOMBRE_PACIENTE,
    PAC.APELLIDO_PACIENTE,PAC.FECHA_DE_REGISTRO_PACIENTE
	FROM DOCTOR DOC INNER JOIN PACIENTE PAC ON  DOC.ID_DOCTOR = PAC.ID_DOCTORPK
	OPEN CUR_DOCTORES
	FETCH CUR_DOCTORES INTO @ID_DOCTOR,@NOMBRE_DOC,
						 @ESPECIALIDAD_DOC,@NOMBRE_PACIENTE,
						 @APELLIDO_PACIENTE,@FECHA_DE_REGISTRO_PACIENTE
	PRINT '  ID_DOCTOR    NOMBRE_DOC       ESPECIALIDAD_DOC    NOMBRE_PACIENTES   APELLIDO_PACIENTES  FECHA_DE_REGISTRO'
	PRINT'-----------------------------------------------------------------------------------'
	WHILE @@FETCH_STATUS=0
		BEGIN
		PRINT @ID_DOCTOR++@NOMBRE_DOC++@ESPECIALIDAD_DOC++@NOMBRE_PACIENTE++@APELLIDO_PACIENTE++@FECHA_DE_REGISTRO_PACIENTE
		FETCH CUR_DOCTORES INTO @ID_DOCTOR,@NOMBRE_DOC,
						    @ESPECIALIDAD_DOC,@NOMBRE_PACIENTE,
						    @APELLIDO_PACIENTE,@FECHA_DE_REGISTRO_PACIENTE
		END
	CLOSE CUR_DOCTORES
	DEALLOCATE CUR_DOCTORES


	-- procedimiento almacenado --
	create procedure retorna
			 @id_paciente char (15)
	as
	select pac.nombre_paciente,con.control_fechas 
	from consulta con inner join paciente pac on 
         pac.id_paciente=con.id_pacientepk
	go
	exec retorna '569'



